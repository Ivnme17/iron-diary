---
import Layout from '../layouts/Layout.astro';
---

<Layout title="DiarioDeHierro - Autenticación">
	<div class="min-h-screen flex items-center justify-center bg-gray-900">
		<div class="max-w-md w-full mx-4">
			<div class="bg-gray-800 border border-gray-700 p-8 rounded-lg shadow-xl">
				<h2 class="text-2xl font-bold mb-6 text-center text-primary-500">Iniciar Sesión</h2>
				<form id="loginForm" class="space-y-4">
					<div>
						<label for="email" class="block text-sm font-medium text-gray-300">Email</label>
						<input type="email" id="email" name="email" required 
							class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-gray-100">
					</div>
					<div>
						<label for="password" class="block text-sm font-medium text-gray-300">Contraseña</label>
						<input type="password" id="password" name="password" required 
							class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-gray-100">
					</div>
					<button type="submit" 
						class="w-full bg-primary-600 text-white py-2 px-4 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-gray-800 transition-colors">
						Iniciar Sesión
					</button>
				</form>
				
				<div class="mt-6 text-center">
					<p class="text-sm text-gray-400">¿No tienes cuenta? 
						<a href="#" onclick="showRegister()" class="text-primary-500 hover:text-primary-400 transition-colors">Regístrate</a>
					</p>
				</div>
			</div>
			
			<div id="registerForm" class="bg-gray-800 border border-gray-700 p-8 rounded-lg shadow-xl mt-4 hidden">
				<h2 class="text-2xl font-bold mb-6 text-center text-primary-500">Registrarse</h2>
				<form id="registerFormElement" class="space-y-4">
					<div>
						<label for="regUsername" class="block text-sm font-medium text-gray-300">Usuario</label>
						<input type="text" id="regUsername" name="username" required 
							class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-gray-100">
					</div>
					<div>
						<label for="regEmail" class="block text-sm font-medium text-gray-300">Email</label>
						<input type="email" id="regEmail" name="email" required 
							class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-gray-100">
					</div>
					<div>
						<label for="regPassword" class="block text-sm font-medium text-gray-300">Contraseña</label>
						<input type="password" id="regPassword" name="password" required 
							class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-gray-100">
					</div>
					<button type="submit" 
						class="w-full bg-primary-600 text-white py-2 px-4 rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-gray-800 transition-colors">
						Registrarse
					</button>
				</form>
				<div class="mt-6 text-center">
					<p class="text-sm text-gray-400">¿Ya tienes cuenta? 
						<a href="#" onclick="showLogin()" class="text-primary-500 hover:text-primary-400 transition-colors">Inicia sesión</a>
					</p>
				</div>
			</div>
		</div>
	</div>

	<script>
		function showRegister() {
			document.getElementById('registerForm').classList.remove('hidden');
			document.querySelector('.bg-gray-800').classList.add('hidden');
		}
		
		function showLogin() {
			document.getElementById('registerForm').classList.add('hidden');
			document.querySelector('.bg-gray-800').classList.remove('hidden');
		}
		
		document.getElementById('loginForm').addEventListener('submit', async (e) => {
			e.preventDefault();
			const formData = new FormData(e.target);
			const data = {
				username: formData.get('email') || '',
				password: formData.get('password') || ''
			};
			
			try {
				const response = await fetch('/api/auth/login', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/x-www-form-urlencoded',
					},
					body: new URLSearchParams(data)
				});
				
				if (response.ok) {
					const result = await response.json();
					localStorage.setItem('token', result.access_token);
					window.location.href = '/dashboard';
				} else {
					alert('Error en el login');
				}
			} catch (error) {
				console.error('Error:', error);
				alert('Error de conexión');
			}
		});
		
		document.getElementById('registerFormElement').addEventListener('submit', async (e) => {
			e.preventDefault();
			const formData = new FormData(e.target);
			const data = {
				username: formData.get('username') || '',
				email: formData.get('email') || '',
				password: formData.get('password') || ''
			};
			
			try {
				const response = await fetch('/api/auth/register', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(data)
				});
				
				if (response.ok) {
					alert('Registro exitoso. Por favor inicia sesión.');
					showLogin();
				} else {
					const error = await response.json();
					alert('Error en el registro: ' + error.detail);
				}
			} catch (error) {
				console.error('Error:', error);
				alert('Error de conexión');
			}
		});
	</script>
</Layout>
